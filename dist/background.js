async function a(){const o=await chrome.tabs.query({}),t={};o.forEach(e=>{const s=new URL(e.url).hostname;t[s]||(t[s]=[]),t[s].push(e.id)});for(const[e,s]of Object.entries(t))s.length>1&&(await chrome.tabs.group({tabIds:s}),await chrome.tabGroups.update(s[0],{title:e}),console.log(`Created group for ${e} with ${s.length} tabs`))}async function c(){const o=await chrome.tabs.query({active:!1}),t=Date.now(),e=30*60*1e3;o.forEach(async s=>{t-s.lastAccessed>e&&(await chrome.tabs.discard(s.id),console.log(`Suspended inactive tab: ${s.title}`))})}async function i(){const o=await chrome.tabs.query({}),t=new Map;o.forEach(e=>{t.has(e.url)?(chrome.tabs.remove(e.id),console.log(`Closed duplicate tab: ${e.title}`)):t.set(e.url,e.id)})}console.log("TabSmart background script loaded");chrome.runtime.onInstalled.addListener(()=>{console.log("TabSmart installed"),chrome.storage.local.set({isPinned:!1,focusModeEnabled:!1,suspendedTabs:[],tabNotes:{}})});chrome.runtime.onMessage.addListener((o,t,e)=>(console.log("Background script received message:",o),o.action==="togglePin"?(chrome.tabs.query({active:!0,currentWindow:!0},function(s){s[0]&&(console.log("Sending togglePinned message to tab:",s[0].id),chrome.tabs.sendMessage(s[0].id,{action:"togglePinned",isPinned:o.isPinned}))}),e({success:!0})):o.action==="groupSimilarTabs"?(a(),e({success:!0})):o.action==="suspendInactiveTabs"?(c(),e({success:!0})):o.action==="detectDuplicateTabs"?(i(),e({success:!0})):o.action==="toggleFocusMode"&&(n(),e({success:!0})),!0));function n(){chrome.storage.local.get("focusModeEnabled",o=>{const t=!o.focusModeEnabled;chrome.storage.local.set({focusModeEnabled:t}),t?chrome.notifications.create({type:"basic",iconUrl:"icon128.png",title:"Focus Mode Enabled",message:"Stay focused! Distracting websites are now blocked."}):chrome.notifications.create({type:"basic",iconUrl:"icon128.png",title:"Focus Mode Disabled",message:"Focus Mode has been turned off."})})}chrome.alarms.create("periodicTasks",{periodInMinutes:15});chrome.alarms.onAlarm.addListener(o=>{o.name==="periodicTasks"&&(a(),c(),i())});
